@inject WalletStorage walletStorage;
@using atomex_frontend.Common;

<div class="modal__container">
  <div class="dark-background modal-title">
    Send
  </div>

  <div class="modal-subtitle">
    @Translations.InstantlySendingOfCurrency
  </div>

  <RoundedContainer>
    <CurrencyModalCard SelectedCurrency="walletStorage.SelectedCurrency" Amount="@walletStorage.SendingAmount" />
  </RoundedContainer>

  <Input
    Description="@Translations.ToAddress"
    InputType="text"
    InputName="sendToAddress"
    Value="@ToAddress"
    OnChange="@SendAddressChange"
    Theme="dark" />

  <Input
    Description="@Translations.Amount" 
    InputType="number" 
    InputName="sendAmount" 
    Value="@Helper.DecimalToStr(walletStorage.SendingAmount)" 
    OnChange="@SendAmountChange"
    Theme="dark"
    AdditionalRightInfo="@String.Concat("$", walletStorage.SendingAmountDollars, " USD")" />
  <Input 
    Description="@Translations.MinersFee" 
    InputType="number" 
    InputName="minersFee" 
    Value="@MinersFee.ToString()" 
    OnChange="@SendMinersFeeChange"
    Theme="dark"
    AdditionalRightInfo="$0.00 USD" />

    <Checkbox Checked="true" Description="@Translations.UseDefaultFee" />

    <div class="modal-buttons-container">
      <div>
        <NavigateButton Variant="left" OnClick="OnCancelClick">
            @Translations.Cancel
        </NavigateButton>
        <NavigateButton Variant="right">
            @Translations.Send
        </NavigateButton>
      </div>
    </div>
</div>

@code {
  [Parameter]
  public EventCallback OnCancelClick { get; set; }

  protected string ToAddress { get; set; } = "";

  protected decimal Amount { get; set; } = 0;

  protected decimal GasPrice { get; set; } = 0;

  protected decimal GasLimit { get; set; } = 0;

  protected decimal MinersFee { get; set; } = 0;

  protected decimal Fee { get; set; } = 0;

  protected void SendAddressChange(string address)
  {
    ToAddress = address;
  }

  protected void SendAmountChange(string amount)
  {
    walletStorage.SendingAmount = Helper.StrToDecimal(amount);
  }

  protected void SendMinersFeeChange(string minersFee)
  {
    MinersFee = Convert.ToDecimal(minersFee);
    Console.WriteLine(MinersFee);
  }

  I18nText.Translations Translations = new I18nText.Translations();
  protected override async Task OnInitializedAsync()
  {
    Translations = await I18nText.GetTextTableAsync<I18nText.Translations>(this);
    await I18nText.SetCurrentLanguageAsync(UserStorage.LangCodes.en.ToName());
    walletStorage.RefreshRequested += StateHasChanged;
  }
}